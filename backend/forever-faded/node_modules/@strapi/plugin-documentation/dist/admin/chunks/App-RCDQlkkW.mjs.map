{"version":3,"file":"App-RCDQlkkW.mjs","sources":["../../../admin/src/pages/App.tsx"],"sourcesContent":["/* eslint-disable import/no-default-export */\nimport * as React from 'react';\n\nimport {\n  LinkButton,\n  Flex,\n  IconButton,\n  Table,\n  Tbody,\n  Td,\n  Th,\n  Thead,\n  Tr,\n  Typography,\n  EmptyStateLayout,\n  Dialog,\n} from '@strapi/design-system';\nimport { Eye as Show, ArrowClockwise as Reload, Trash } from '@strapi/icons';\nimport {\n  ConfirmDialog,\n  useRBAC,\n  Page,\n  useAPIErrorHandler,\n  useNotification,\n  Layouts,\n} from '@strapi/strapi/admin';\nimport { useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\n\nimport { PERMISSIONS } from '../constants';\nimport {\n  useGetInfoQuery,\n  useRegenerateDocMutation,\n  useDeleteVersionMutation,\n} from '../services/api';\nimport { getTrad } from '../utils';\n\nconst App = () => {\n  const { formatMessage } = useIntl();\n  const { toggleNotification } = useNotification();\n  const { formatAPIError } = useAPIErrorHandler();\n  const { data, isLoading: isLoadingInfo, isError } = useGetInfoQuery();\n  const [regenerate] = useRegenerateDocMutation();\n  const [deleteVersion] = useDeleteVersionMutation();\n  const [showConfirmDelete, setShowConfirmDelete] = React.useState<boolean>(false);\n  const [versionToDelete, setVersionToDelete] = React.useState<string>();\n  const { allowedActions, isLoading: isLoadingRBAC } = useRBAC(PERMISSIONS);\n\n  const isLoading = isLoadingInfo || isLoadingRBAC;\n\n  const colCount = 4;\n  const rowCount = (data?.docVersions?.length || 0) + 1;\n\n  const handleRegenerateDoc = (version: string) => {\n    regenerate({ version })\n      .unwrap()\n      .then(() => {\n        toggleNotification({\n          type: 'success',\n          message: formatMessage({\n            id: getTrad('notification.generate.success'),\n            defaultMessage: 'Successfully generated documentation',\n          }),\n        });\n      })\n      .catch((err) => {\n        toggleNotification({\n          type: 'warning',\n          message: formatAPIError(err),\n        });\n      });\n  };\n\n  const handleShowConfirmDelete = () => {\n    setShowConfirmDelete(!showConfirmDelete);\n  };\n\n  const handleConfirmDelete = async () => {\n    if (!versionToDelete) {\n      // nothing to delete\n      return;\n    }\n\n    await deleteVersion({ version: versionToDelete })\n      .unwrap()\n      .then(() => {\n        toggleNotification({\n          type: 'success',\n          message: formatMessage({\n            id: getTrad('notification.delete.success'),\n            defaultMessage: 'Successfully deleted documentation',\n          }),\n        });\n      })\n      .catch((err) => {\n        toggleNotification({\n          type: 'warning',\n          message: formatAPIError(err),\n        });\n      });\n\n    setShowConfirmDelete(!showConfirmDelete);\n  };\n\n  const handleClickDelete = (version: string) => {\n    setVersionToDelete(version);\n    setShowConfirmDelete(!showConfirmDelete);\n  };\n\n  const title = formatMessage({\n    id: getTrad('plugin.name'),\n    defaultMessage: 'Documentation',\n  });\n\n  if (isLoading) {\n    return <Page.Loading />;\n  }\n\n  if (isError) {\n    return <Page.Error />;\n  }\n\n  return (\n    <Layouts.Root>\n      <Page.Title>{title}</Page.Title>\n      <Page.Main>\n        <Layouts.Header\n          title={title}\n          subtitle={formatMessage({\n            id: getTrad('pages.PluginPage.header.description'),\n            defaultMessage: 'Configure the documentation plugin',\n          })}\n          primaryAction={\n            <OpenDocLink\n              disabled={!allowedActions.canRead || !data?.currentVersion || !data?.prefix}\n              href={createDocumentationHref(`${data?.prefix}/v${data?.currentVersion}`)}\n              startIcon={<Show />}\n            >\n              {formatMessage({\n                id: getTrad('pages.PluginPage.Button.open'),\n                defaultMessage: 'Open Documentation',\n              })}\n            </OpenDocLink>\n          }\n        />\n        <Layouts.Content>\n          {data?.docVersions.length ? (\n            <Table colCount={colCount} rowCount={rowCount}>\n              <Thead>\n                <Tr>\n                  <Th>\n                    <Typography variant=\"sigma\" textColor=\"neutral600\">\n                      {formatMessage({\n                        id: getTrad('pages.PluginPage.table.version'),\n                        defaultMessage: 'Version',\n                      })}\n                    </Typography>\n                  </Th>\n                  <Th>\n                    <Typography variant=\"sigma\" textColor=\"neutral600\">\n                      {formatMessage({\n                        id: getTrad('pages.PluginPage.table.generated'),\n                        defaultMessage: 'Last Generated',\n                      })}\n                    </Typography>\n                  </Th>\n                </Tr>\n              </Thead>\n              <Tbody>\n                {data.docVersions\n                  .slice(0)\n                  .sort((a, b) => (a.generatedDate < b.generatedDate ? 1 : -1))\n                  .map((doc) => (\n                    <Tr key={doc.version}>\n                      <Td width=\"50%\">\n                        <Typography>{doc.version}</Typography>\n                      </Td>\n                      <Td width=\"50%\">\n                        <Typography>{doc.generatedDate}</Typography>\n                      </Td>\n                      <Td>\n                        <Flex justifyContent=\"end\" onClick={(e) => e.stopPropagation()}>\n                          <IconButton\n                            tag=\"a\"\n                            disabled={!allowedActions.canRead}\n                            href={createDocumentationHref(`${data.prefix}/v${doc.version}`)}\n                            variant=\"ghost\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            label={formatMessage(\n                              {\n                                id: getTrad('pages.PluginPage.table.icon.show'),\n                                defaultMessage: 'Open {target}',\n                              },\n                              { target: `${doc.version}` }\n                            )}\n                          >\n                            <Show />\n                          </IconButton>\n                          {allowedActions.canRegenerate ? (\n                            <IconButton\n                              onClick={() => handleRegenerateDoc(doc.version)}\n                              variant=\"ghost\"\n                              label={formatMessage(\n                                {\n                                  id: getTrad('pages.PluginPage.table.icon.regenerate'),\n                                  defaultMessage: 'Regenerate {target}',\n                                },\n                                { target: `${doc.version}` }\n                              )}\n                            >\n                              <Reload />\n                            </IconButton>\n                          ) : null}\n                          {allowedActions.canUpdate && doc.version !== data.currentVersion ? (\n                            <IconButton\n                              onClick={() => handleClickDelete(doc.version)}\n                              variant=\"ghost\"\n                              label={formatMessage(\n                                {\n                                  id: 'global.delete-target',\n                                  defaultMessage: 'Delete {target}',\n                                },\n                                { target: `${doc.version}` }\n                              )}\n                            >\n                              <Trash />\n                            </IconButton>\n                          ) : null}\n                        </Flex>\n                      </Td>\n                    </Tr>\n                  ))}\n              </Tbody>\n            </Table>\n          ) : (\n            <EmptyStateLayout content=\"\" icon={null} />\n          )}\n        </Layouts.Content>\n        <Dialog.Root open={showConfirmDelete} onOpenChange={setShowConfirmDelete}>\n          <ConfirmDialog onConfirm={handleConfirmDelete} />\n        </Dialog.Root>\n      </Page.Main>\n    </Layouts.Root>\n  );\n};\n\n/**\n * TODO: should this be fixed in the DS?\n */\nconst OpenDocLink = styled(LinkButton)`\n  text-decoration: none;\n`;\n\nconst createDocumentationHref = (path: string) => {\n  if (path.startsWith('http')) {\n    return path;\n  }\n\n  if (path.startsWith('/')) {\n    return `${window.strapi.backendURL}${path}`;\n  }\n\n  return `${window.strapi.backendURL}/${path}`;\n};\n\nexport { App };\n"],"names":["App","formatMessage","useIntl","toggleNotification","useNotification","formatAPIError","useAPIErrorHandler","data","isLoading","isLoadingInfo","isError","useGetInfoQuery","regenerate","useRegenerateDocMutation","deleteVersion","useDeleteVersionMutation","showConfirmDelete","setShowConfirmDelete","React","useState","versionToDelete","setVersionToDelete","allowedActions","isLoadingRBAC","useRBAC","PERMISSIONS","colCount","rowCount","docVersions","length","handleRegenerateDoc","version","unwrap","then","type","message","id","getTrad","defaultMessage","catch","err","handleConfirmDelete","handleClickDelete","title","_jsx","Page","Loading","Error","_jsxs","Layouts","Root","Title","Main","Header","subtitle","primaryAction","OpenDocLink","disabled","canRead","currentVersion","prefix","href","createDocumentationHref","startIcon","Show","Content","Table","Thead","Tr","Th","Typography","variant","textColor","Tbody","slice","sort","a","b","generatedDate","map","doc","Td","width","Flex","justifyContent","onClick","e","stopPropagation","IconButton","tag","target","rel","label","canRegenerate","Reload","canUpdate","Trash","EmptyStateLayout","content","icon","Dialog","open","onOpenChange","ConfirmDialog","onConfirm","styled","LinkButton","path","startsWith","window","strapi","backendURL"],"mappings":"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"}