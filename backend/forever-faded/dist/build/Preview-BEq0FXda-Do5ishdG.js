import{cQ as H,j as e,cR as S,cS as D,by as C,i as E,P as g,B as m,cU as W,u as h,b1 as v,r as A,cY as U,c_ as z,eV as G,cV as N,cW as V,aW as $,F as x,g as k,bO as T,I as b,e1 as B,H as f,d as P,eW as w,bG as q,bm as O,b_ as Q,T as _,d4 as Y,a5 as j}from"./strapi-LXg_-w_d.js";import{F as X}from"./Input-BexkC_pp-B1uSHM_x.js";import{getDocumentStatus as L}from"./EditViewPage-CYe7wAXF-B6Zhybeh.js";import"./Relations-qeZyLDgQ-D2V1MA3S.js";import"./relations-Cq8NRUto-B6NM_52F.js";import"./usePrev-Bjw2dhmq-Bx_IqyBC.js";import"./useDragAndDrop-HYwNDExe-gx4TRx6h.js";import"./objects-wl73iEma-Di6oXytG.js";import"./ComponentIcon-BZcTc4rj-DFlhRQyo.js";import"./getEmptyImage-CjqolaH3.js";const J=()=>{const t=d("PreviewContent",a=>a.url),s=d("PreviewContent",a=>a.layout),{formatMessage:n}=h();return e.jsxs(x,{flex:1,overflow:"auto",alignItems:"stretch",children:[e.jsx(m,{overflow:"auto",flex:1,borderWidth:"0 1px 0 0",borderColor:"neutral150",padding:6,children:e.jsx(X,{layout:s.layout,hasBackground:!0})}),e.jsx(m,{src:t,title:n({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),flex:1,height:"100%",borderWidth:0,tag:"iframe"},t)]})},K=()=>{const t=d("PreviewContent",n=>n.url),{formatMessage:s}=h();return e.jsx(m,{src:t,title:s({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"},t)},M=()=>{const[{query:t}]=v(),{formatMessage:s}=h(),n=w("BackButton",l=>l.canGoBack),a=w("BackButton",l=>l.goBack),o=w("BackButton",l=>l.history),r=w("BackButton",l=>l.currentLocationIndex),u=n?o.at(r-2):void 0,c={pathname:"..",search:q.stringify(t,{encode:!1})},p=u??c,i=l=>{if(n){l.preventDefault(),a();return}};return e.jsx(b,{variant:"ghost",tag:O,relative:"path",to:p,onClick:i,label:s({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(Q,{})})},I=()=>{const t=d("PreviewHeader",r=>r.document),s=d("PreviewHeader",r=>r.schema),n=d("PreviewHeader",r=>r.meta);if(!(s?.options?.draftAndPublish??!1))return null;const o=L(t,n);return e.jsx(Y,{status:o,size:"XS"})},R=()=>{const{formatMessage:t}=h(),[{query:s},n]=v(),a=d("PreviewHeader",i=>i.document),o=d("PreviewHeader",i=>i.schema),r=d("PreviewHeader",i=>i.meta),u=o?.options?.draftAndPublish??!1,c=L(a,r),p=i=>{(i==="published"||i==="draft")&&n({status:i},"push",!0)};return u?e.jsx(e.Fragment,{children:e.jsx(j.Root,{variant:"simple",value:s.status||"draft",onValueChange:p,children:e.jsxs(j.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(y,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(y,{value:"published",disabled:c==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})})}):null},Z=()=>{const t=d("PreviewHeader",r=>r.title),{formatMessage:s}=h(),{toggleNotification:n}=k(),{copy:a}=T(),o=()=>{a(window.location.href),n({message:s({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(x,{gap:4,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(te,{height:"100%",paddingLeft:2,paddingRight:4,children:[e.jsx(M,{}),e.jsx(F,{tag:"h1",title:t,maxWidth:"200px",fontSize:2,paddingLeft:2,paddingRight:3,fontWeight:600,children:t}),e.jsx(I,{})]}),e.jsxs(x,{flex:1,paddingRight:2,justifyContent:"space-between",children:[e.jsx(R,{}),e.jsx(b,{type:"button",label:s({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:o,children:e.jsx(B,{})})]})]})},ee=()=>{const t=d("PreviewHeader",r=>r.title),{formatMessage:s}=h(),{toggleNotification:n}=k(),{copy:a}=T(),o=()=>{a(window.location.href),n({message:s({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(f.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(f.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(M,{}),e.jsx(F,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",title:t,children:t}),e.jsx(I,{})]}),e.jsx(f.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx(R,{})}),e.jsx(f.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(b,{type:"button",label:s({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:o,children:e.jsx(B,{})})})]})},F=P(_)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,y=P(j.Trigger)`
  text-transform: uppercase;
`,te=P(x)`
  border-right: 1px solid ${({theme:t})=>t.colors.neutral150};
`,[se,d]=H("PreviewPage"),ne=()=>{const{formatMessage:t}=h(),{slug:s,id:n,collectionType:a}=C(),[{query:o}]=v(),r=A.useMemo(()=>U(o),[o]);if(!a)throw new Error("Could not find collectionType in url params");if(!s)throw new Error("Could not find model in url params");if(a===z&&!n)throw new Error("Could not find documentId in url params");const u=G({params:{contentType:s},query:{documentId:n,locale:r.locale,status:r.status}}),c=N({model:s,collectionType:a,documentId:n,params:r}),p=V(s);if(c.isLoading||u.isLoading||p.isLoading)return e.jsx(g.Loading,{});if(u.error||p.error||!c.document||!c.meta||!c.schema)return e.jsx(g.Error,{});if(!u.data?.data?.url)return e.jsx(g.NoData,{});const i=c.getTitle(p.edit.settings.mainField);return e.jsxs(e.Fragment,{children:[e.jsx(g.Title,{children:t({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:i})}),e.jsx(se,{url:u.data.data.url,document:c.document,title:i,meta:c.meta,schema:c.schema,layout:p.edit,children:e.jsx($,{method:"POST",initialValues:c.document,height:"100%",children:e.jsx(x,{direction:"column",height:"100%",alignItems:"stretch",children:window.strapi.future.isEnabled("unstablePreviewSideEditor")?e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx(J,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(K,{})]})})})})]})},ae=()=>{const{slug:t}=C(),{permissions:s=[],isLoading:n,error:a}=E([{action:"plugin::content-manager.explorer.read",subject:t},{action:"plugin::content-manager.explorer.update",subject:t}]);return n?e.jsx(g.Loading,{}):a||!t?e.jsx(m,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(g.Error,{})}):e.jsx(m,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(g.Protect,{permissions:s.filter(o=>o.action.includes("explorer.read")),children:e.jsx(W,{permissions:s,children:e.jsx(ne,{})})})})},me=()=>e.jsx(S,{children:e.jsx(D,{children:e.jsx(ae,{})})});export{me as ProtectedPreviewPage,d as usePreviewContext};
